"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.sleep = sleep;
exports.within = within;
exports.atleast = atleast;
function sleep(ms, fn) {
    if (!fn) return new Promise(resolve => setTimeout(resolve, ms));else arguments[2] !== undefined ? setTimeout(fn, ms, ...Array.slice.call(arguments, 2)) : setTimeout(fn, ms);
}

function within(t1, t2, task) {
    if (!task) task = t2, t2 = null;

    if (typeof task != "function") return {
        try(task) {
            return within(t1, t2, task);
        }
    };

    task = task();

    const timeout = new Promise((_, reject) => {
        setTimeout(reject, t2 || t1, "timeout");
    });

    task = Promise.race([timeout, task]);

    return t2 ? atleast(t1, task) : task;
}

function atleast(ms, task) {
    return Promise.all([task, sleep(ms)]).then(([task]) => task);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJzbGVlcCIsIndpdGhpbiIsImF0bGVhc3QiLCJtcyIsImZuIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiQXJyYXkiLCJzbGljZSIsImNhbGwiLCJ0MSIsInQyIiwidGFzayIsInRyeSIsInRpbWVvdXQiLCJfIiwicmVqZWN0IiwicmFjZSIsImFsbCIsInRoZW4iXSwibWFwcGluZ3MiOiI7Ozs7O1FBQWdCQSxLLEdBQUFBLEs7UUFPQUMsTSxHQUFBQSxNO1FBeUJBQyxPLEdBQUFBLE87QUFoQ1QsU0FBU0YsS0FBVCxDQUFlRyxFQUFmLEVBQW1CQyxFQUFuQixFQUF1QjtBQUMxQixRQUFHLENBQUNBLEVBQUosRUFBUSxPQUFPLElBQUlDLE9BQUosQ0FBWUMsV0FBV0MsV0FBV0QsT0FBWCxFQUFvQkgsRUFBcEIsQ0FBdkIsQ0FBUCxDQUFSLEtBQ0tLLFVBQVUsQ0FBVixNQUFpQkMsU0FBakIsR0FDQ0YsV0FBV0gsRUFBWCxFQUFlRCxFQUFmLEVBQW1CLEdBQUdPLE1BQU1DLEtBQU4sQ0FBWUMsSUFBWixDQUFpQkosU0FBakIsRUFBNEIsQ0FBNUIsQ0FBdEIsQ0FERCxHQUVDRCxXQUFXSCxFQUFYLEVBQWVELEVBQWYsQ0FGRDtBQUdSOztBQUVNLFNBQVNGLE1BQVQsQ0FBZ0JZLEVBQWhCLEVBQW9CQyxFQUFwQixFQUF3QkMsSUFBeEIsRUFBNkI7QUFDaEMsUUFBRyxDQUFDQSxJQUFKLEVBQ0lBLE9BQU9ELEVBQVAsRUFDQUEsS0FBSyxJQURMOztBQUdKLFFBQUcsT0FBT0MsSUFBUCxJQUFlLFVBQWxCLEVBQ0ksT0FBTztBQUNIQyxZQUFJRCxJQUFKLEVBQVM7QUFDTCxtQkFBT2QsT0FBT1ksRUFBUCxFQUFXQyxFQUFYLEVBQWVDLElBQWYsQ0FBUDtBQUNIO0FBSEUsS0FBUDs7QUFNSkEsV0FBT0EsTUFBUDs7QUFFQSxVQUFNRSxVQUFVLElBQUlaLE9BQUosQ0FDWixDQUFDYSxDQUFELEVBQUlDLE1BQUosS0FBZTtBQUFFWixtQkFDYlksTUFEYSxFQUNMTCxNQUFNRCxFQURELEVBQ0ssU0FETDtBQUVmLEtBSFUsQ0FBaEI7O0FBTUFFLFdBQU9WLFFBQVFlLElBQVIsQ0FBYSxDQUFFSCxPQUFGLEVBQVdGLElBQVgsQ0FBYixDQUFQOztBQUVBLFdBQU9ELEtBQUtaLFFBQVFXLEVBQVIsRUFBWUUsSUFBWixDQUFMLEdBQXlCQSxJQUFoQztBQUNIOztBQUVNLFNBQVNiLE9BQVQsQ0FBaUJDLEVBQWpCLEVBQXFCWSxJQUFyQixFQUEwQjtBQUM3QixXQUFPVixRQUNGZ0IsR0FERSxDQUNFLENBQUVOLElBQUYsRUFBUWYsTUFBTUcsRUFBTixDQUFSLENBREYsRUFFRm1CLElBRkUsQ0FFRyxDQUFDLENBQUNQLElBQUQsQ0FBRCxLQUFZQSxJQUZmLENBQVA7QUFHSCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBzbGVlcChtcywgZm4pIHtcbiAgICBpZighZm4pIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgICBlbHNlIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8gc2V0VGltZW91dChmbiwgbXMsIC4uLkFycmF5LnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKSlcbiAgICAgICAgOiBzZXRUaW1lb3V0KGZuLCBtcylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhpbih0MSwgdDIsIHRhc2spe1xuICAgIGlmKCF0YXNrKVxuICAgICAgICB0YXNrID0gdDIsXG4gICAgICAgIHQyID0gbnVsbFxuXG4gICAgaWYodHlwZW9mIHRhc2sgIT0gXCJmdW5jdGlvblwiKVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHJ5KHRhc2spe1xuICAgICAgICAgICAgICAgIHJldHVybiB3aXRoaW4odDEsIHQyLCB0YXNrKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB0YXNrID0gdGFzaygpO1xuXG4gICAgY29uc3QgdGltZW91dCA9IG5ldyBQcm9taXNlKFxuICAgICAgICAoXywgcmVqZWN0KSA9PiB7IHNldFRpbWVvdXQoXG4gICAgICAgICAgICByZWplY3QsIHQyIHx8IHQxLCBcInRpbWVvdXRcIlxuICAgICAgICApfVxuICAgIClcbiAgICBcbiAgICB0YXNrID0gUHJvbWlzZS5yYWNlKFsgdGltZW91dCwgdGFzayBdKVxuICAgIFxuICAgIHJldHVybiB0MiA/IGF0bGVhc3QodDEsIHRhc2spIDogdGFzaztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0bGVhc3QobXMsIHRhc2spe1xuICAgIHJldHVybiBQcm9taXNlXG4gICAgICAgIC5hbGwoWyB0YXNrLCBzbGVlcChtcykgXSlcbiAgICAgICAgLnRoZW4oKFt0YXNrXSkgPT4gdGFzayk7XG59Il19